*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.20" SourceFile="gammathreshold.scx" CPID="1252" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	*<PropValue>
		DataSource = .NULL.
		Height = 200
		Left = 1
		Name = "Dataenvironment"
		Top = 220
		Width = 520
	*</PropValue>

ENDDEFINE

DEFINE CLASS form1 AS form 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Imgcanvas1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtFile" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Image1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.Command1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.Command7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.oGamma" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.Label10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.lblGamma" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.oThreshold" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.Label2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.lblThreshold" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1.chkThreshold" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Command2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Command1" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: processimage
		*p: obmp
		*p: oclrmatrix
	*</DefinedPropArrayMethod>

	*<PropValue>
		Caption = "Image transformations using Gamma and Threshold"
		DoCreate = .T.
		Height = 352
		Left = 7
		Name = "Form1"
		obmp = 0
		oclrmatrix = 0
		ShowTips = .T.
		Top = 7
		Width = 516
	*</PropValue>

	ADD OBJECT 'Command1' AS commandbutton WITH ;
		Anchor = 6, ;
		Caption = "", ;
		Height = 25, ;
		Left = 12, ;
		Name = "Command1", ;
		Picture = (home() + "/samples/solution/bts.bmp"), ;
		PicturePosition = 1, ;
		PictureSpacing = 1, ;
		TabIndex = 4, ;
		ToolTipText = "To convert to monochrome, select GreyScale and Activate Threshold", ;
		Top = 324, ;
		Width = 26
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Command2' AS commandbutton WITH ;
		Anchor = 6, ;
		Caption = "Get Picture", ;
		Height = 25, ;
		Left = 12, ;
		Name = "Command2", ;
		Picture = (home() + "/graphics/bitmaps/outline/open.bmp"), ;
		PicturePosition = 1, ;
		PictureSpacing = 1, ;
		TabIndex = 1, ;
		Top = 204, ;
		Width = 98
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Container1' AS container WITH ;
		Anchor = 6, ;
		Height = 84, ;
		Left = 12, ;
		Name = "Container1", ;
		SpecialEffect = 0, ;
		TabIndex = 3, ;
		Top = 240, ;
		Visible = .T., ;
		Width = 492
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Container1.chkThreshold' AS checkbox WITH ;
		Alignment = 0, ;
		Caption = "Activate Threshold", ;
		Height = 17, ;
		Left = 363, ;
		Name = "chkThreshold", ;
		TabIndex = 5, ;
		Top = 48, ;
		Value = .T., ;
		Width = 120
		*< END OBJECT: BaseClass="checkbox" />

	ADD OBJECT 'Container1.Command1' AS commandbutton WITH ;
		Anchor = 12, ;
		Caption = "GreyScale", ;
		Height = 25, ;
		Left = 12, ;
		Name = "Command1", ;
		TabIndex = 1, ;
		Top = 12, ;
		Width = 98
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Container1.Command7' AS commandbutton WITH ;
		Anchor = 12, ;
		Caption = "Restore", ;
		Height = 25, ;
		Left = 12, ;
		Name = "Command7", ;
		TabIndex = 2, ;
		Top = 48, ;
		Width = 98
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Container1.Label10' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Gamma", ;
		Height = 17, ;
		Left = 138, ;
		Name = "Label10", ;
		TabIndex = 6, ;
		Top = 12, ;
		Width = 47
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Container1.Label2' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Threshold", ;
		Height = 17, ;
		Left = 126, ;
		Name = "Label2", ;
		TabIndex = 9, ;
		Top = 47, ;
		Width = 58
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Container1.lblGamma' AS label WITH ;
		BackStyle = 0, ;
		Caption = "100", ;
		Height = 17, ;
		Left = 333, ;
		Name = "lblGamma", ;
		TabIndex = 7, ;
		Top = 12, ;
		Width = 26
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Container1.lblThreshold' AS label WITH ;
		BackStyle = 0, ;
		Caption = "50", ;
		Height = 17, ;
		Left = 333, ;
		Name = "lblThreshold", ;
		TabIndex = 8, ;
		Top = 48, ;
		Width = 26
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Container1.oGamma' AS olecontrol WITH ;
		Height = 19, ;
		Left = 186, ;
		Name = "oGamma", ;
		TabIndex = 3, ;
		Top = 12, ;
		Width = 145
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\windows\system32\comctl32.ocx" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKDNjyv628cBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAJoAAAAAAAAABQAAAAIAAAD+////BAAAAAYAAAD+/////v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////w9z83i+vNEYggCAArL09aIUM0EggAAAD8DgAA9wEAAIZ+4eYCAAUAHAAAAAAAAAAFAAAACgAAAAEAAAD0AQAATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACADAAAAFNtYWxsQ2hhbmdlAAkAAABJCgAAAAoAAAAEAAAATWF4AAkAAABJCgAAAPQBAAAEAAAATWluAAkAAABJCgAAAAEAAAAMAAAAU2VsZWN0UmFuZ2UABQAAAEwAAAAADgAAAFRpY2tGcmVxdWVuY3kACQAAAEkKAAAAMgAAYwBkAAAAAAAAAAAAAAAyAAAAZAAAAAHvzasAAAUAAOoeAAYAMQAAAAAA7OnYAJYzUHcf3uy9AQAFAAAAAAAAAAAGAAAAVmFsdWUACQAAAEkKAAAAZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />

	ADD OBJECT 'Container1.oThreshold' AS olecontrol WITH ;
		Height = 19, ;
		Left = 186, ;
		Name = "oThreshold", ;
		TabIndex = 4, ;
		Top = 48, ;
		Width = 145
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\windows\system32\comctl32.ocx" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKDNjyv628cBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAJoAAAAAAAAABQAAAAIAAAD+////BAAAAAYAAAD+/////v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////w9z83i+vNEYggCAArL09aIUM0EggAAAD8DgAA9wEAAIZ+4eYCAAUAHAAAAAAAAAAFAAAABQAAAAAAAABkAAAATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACADAAAAFNtYWxsQ2hhbmdlAAkAAABJCgAAAAUAAAAEAAAATWF4AAkAAABJCgAAAGQAAAAEAAAATWluAAkAAABJCgAAAAAAAAAMAAAAU2VsZWN0UmFuZ2UABQAAAEwAAAAADgAAAFRpY2tGcmVxdWVuY3kACQAAAEkKAAAACgAAYwAyAAAAAAAAAAAAAAAKAAAAMgAAAAHvzasAAAUA6OYeAAYAMQAAAAAA7OnYAJYzUHcf3uy9AQAFAAAAAAAAAAAGAAAAVmFsdWUACQAAAEkKAAAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />

	ADD OBJECT 'Image1' AS image WITH ;
		Anchor = 3, ;
		Height = 180, ;
		Left = 12, ;
		Name = "Image1", ;
		Stretch = 2, ;
		Top = 12, ;
		Width = 240
		*< END OBJECT: BaseClass="image" />

	ADD OBJECT 'Imgcanvas1' AS imgcanvas WITH ;
		Anchor = 15, ;
		Height = 180, ;
		Left = 264, ;
		Name = "Imgcanvas1", ;
		Top = 12, ;
		Width = 240
		*< END OBJECT: ClassLib="..\gdiplusx.vcx" BaseClass="image" />

	ADD OBJECT 'txtFile' AS textbox WITH ;
		Anchor = 6, ;
		DisabledBackColor = 255,255,255, ;
		DisabledForeColor = 0,0,0, ;
		Enabled = .F., ;
		FontSize = 8, ;
		Height = 25, ;
		Left = 120, ;
		Name = "txtFile", ;
		TabIndex = 2, ;
		Top = 204, ;
		Width = 384
		*< END OBJECT: BaseClass="textbox" />
	
	PROCEDURE Init
		DODEFAULT()
		Thisform.ProcessImage("Cebolinha.png")
		Thisform.Container1.Command1.Click()
	ENDPROC

	PROCEDURE processimage
		LPARAMETERS tcFile
		tcFile = LOCFILE(tcFile)
		
		WITH Thisform
			.Container1.oGamma.SetFocus()
			.Container1.oThreshold.SetFocus()
			
			.txtFile.Value = tcFile
			.Image1.Picture = tcFile
			.obmp = _Screen.System.Drawing.Bitmap.New(Thisform.txtFile.Value)
			.oClrMatrix = _Screen.System.Drawing.Imaging.ColorMatrix.New()
			.Imgcanvas1.Draw()
		ENDWITH
	ENDPROC

	PROCEDURE Command2.Click
		LOCAL lcFile
		lcFile = GETPICT()
		IF EMPTY(lcFile)
			RETURN
		ENDIF
		Thisform.ProcessImage(lcFile)
	ENDPROC

	PROCEDURE Container1.chkThreshold.InteractiveChange
		This.Parent.oThreshold.OBJECT.Enabled = This.Value
		Thisform.Imgcanvas1.Draw()
		
	ENDPROC

	PROCEDURE Container1.Command1.Click
		WITH Thisform
			.oClrMatrix = _Screen.System.Drawing.Imaging.ColorMatrix.New( ; 
		        0.33, 0.33, 0.33, 0.0, 0.0, ; 
		        0.33, 0.33, 0.33, 0.0, 0.0, ; 
		        0.33, 0.33, 0.33, 0.0, 0.0, ;
		        0.0 , 0.0 , 0.0 , 1.0, 0.0, ; 
		        0.0 , 0.0 , 0.0 , 0.0, 1.0)
			.imgcanvas1.Draw()
		ENDWITH
	ENDPROC

	PROCEDURE Container1.Command7.Click
		WITH This.Parent
			.oGamma.Value = 100
			.lblGamma.Caption = "100"
			
			.oThreshold.Value = 50
			.lblThreshold.Caption = "50"
		
			.chkThreshold.Value = .F.
		ENDWITH
		
		Thisform.oClrMatrix = _Screen.System.Drawing.Imaging.ColorMatrix.New()
		Thisform.ImgCanvas1.Draw()
		
	ENDPROC

	PROCEDURE Container1.oGamma.Change
		*** ActiveX Control Event ***
		WITH This.Parent
			.lblGamma.Caption = TRANSFORM(This.Value)
		ENDWITH
		Thisform.ImgCanvas1.Draw()
		
	ENDPROC

	PROCEDURE Container1.oGamma.Scroll
		*** ActiveX Control Event ***
		This.Change
		
	ENDPROC

	PROCEDURE Container1.oThreshold.Change
		*** ActiveX Control Event ***
		WITH This.Parent
			.lblThreshold.Caption = TRANSFORM(This.Value)
		ENDWITH
		Thisform.ImgCanvas1.Draw()
		
	ENDPROC

	PROCEDURE Container1.oThreshold.Init
		This.OBJECT.Enabled = .F.
	ENDPROC

	PROCEDURE Container1.oThreshold.Scroll
		*** ActiveX Control Event ***
		This.Change
		
	ENDPROC

	PROCEDURE Imgcanvas1.beforedraw
		IF EMPTY(Thisform.txtFile.Value)
			RETURN
		ENDIF
		
		This.Clear
		
		LOCAL loAttr AS xfcImageAttributes
		LOCAL loClrMatrix AS xfcColorMatrix
		
		LOCAL lnGamma, lnThreshold
		
		lnGamma = Thisform.Container1.oGamma.OBJECT.Value
		lnThreshold = Thisform.Container1.oThreshold.OBJECT.Value
		
		WITH _SCREEN.System.Drawing
			loAttr = .Imaging.ImageAttributes.New() 
			loAttr.SetGamma(lnGamma / 100)
			
			IF Thisform.Container1.chkThreshold.Value
				loAttr.SetThreshold(lnThreshold / 100)
			ENDIF 
			loAttr.SetColorMatrix(Thisform.oClrMatrix)
			This.oGfx.DrawImage(Thisform.oBmp, This.Rectangle, Thisform.oBmp.GetBounds(), 2, loAttr) 
		ENDWITH
		
		RETURN
	ENDPROC

ENDDEFINE
